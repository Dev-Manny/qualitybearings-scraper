const metaboScraperObject = {
  async scraper(browser) {
    let scrapedData = [];

    async function scrapeCurrentPage() {
      let catalogs = [
        '626462000',
        '626463000',
        '626464000',
        '626482000',
        '626483000',
        '626488000',
        '626489000',
        '626490000',
        '626491000',
        '626492000',
        '626815000',
        '623765000',
        '623796000',
        '623801000',
        '623804000',
        '623805000',
        '655133000',
        '655134000',
        '655134010',
        '655136000',
        '655137000',
        '655137005',
        '655138000',
        '655200000',
        '655201000',
        '655207000',
        '655209000',
        '655210000',
        '655211000',
        '655215000',
        '655218000',
        '655218010',
        '655221000',
        '655227000',
        '655228005',
        '655229005',
        '655230005',
        '655231005',
        '655232005',
        '655233005',
        '655234000',
        '655235000',
        '655202000',
        '655205000',
        '655204000',
        '626816000',
        '616341119',
        '616342119',
        '616343119',
        'US16344119',
        '616345119',
        '616331420',
        '616333000',
        '616337420',
        '616146000',
        'US616338000',
        '616340000',
        '655236000',
        'US616327000',
        'US616215000',
        'US616136000',
        'US616137000',
        'US616156000',
        '616168000',
        '616140000',
        '616139000',
        '616160000',
        '616159000',
        '616142000',
        '616149000',
        'US616204000',
        'US616203000',
        '616365000',
        '616366000',
        '616367000',
        '628273000',
        '628276000',
        '655401000',
        '655402000',
        '655403000',
        '655405000',
        '655406000',
        '655407000',
        '655408000',
        '655410000',
        '655411000',
        '655412000',
        '655413000',
        '655414000',
        '655415000',
        '655416000',
        '655417000',
        '655419000',
        '655420000',
        '655421000',
        '655423000',
        '655424000',
        '655431000',
        '655432000',
        '655433000',
        '655434000',
        '655435000',
        '655436000',
        '655438000',
        '655439000',
        '655440000',
        '655441000',
        '655442000',
        '655216000',
        '655217000',
        '655368000',
        '655369000',
        '655370000',
        '655371000',
        '655372000',
        '655373000',
        '655374000',
        '655375000',
        '655376000',
        '655377000',
        '655378000',
        '655379000',
        '655390000',
        '655391000',
        '655392000',
        '655393000',
        '655394000',
        '655380000',
        '655381000',
        '655383000',
        '655384000',
        '655385000',
        '655386000',
        '655387000',
        '656750000',
        '656751000',
        '656752000',
        '656753000',
        '656754000',
        '656755000',
        '656756000',
        '656757000',
        '656758000',
        '656759000',
        '655212000',
        '655213000',
        '655219000',
        '655214000',
        '655222000',
        '623520000',
        '623522000',
        '623524000',
        '626376000',
        '623530000',
        '626398000',
        '623470000',
        '623542000',
        '623512000',
        '623473000',
        '623474000',
        '623475000',
        '623476000',
        '623519000',
        '623495000',
        '623496000',
        '626405000',
        '626406000',
        '626407000',
        '626408000',
        '626409000',
        '626410000',
        '623477000',
        '623513000',
        '623479000',
        '623480000',
        '623481000',
        '623482000',
        '623483000',
        '623484000',
        '623485000',
        '623526000',
        '623527000',
        '623528000',
        '623486000',
        '623487000',
        '623488000',
        '623514000',
        '623468000',
        '623469000',
        '623494000',
        '623525000',
        '623510000',
        '623499000',
        '623501000',
        '623503000',
        '623505000',
        '623506000',
        '623507000',
        '623508000',
        '623509000',
        '623511000',
        '623529000',
        '626413000',
        '623536000',
        '623537000',
        '623538000',
        '623539000',
        '623541000',
        '656790000',
        '656791000',
        '626279000',
        '626280000',
        '626281000',
        '626282000',
        '626283000',
        '626284000',
        '626285000',
        '626286000',
        '626290000',
        '626291000',
        '626292000',
        '626293000',
        '626294000',
        '626295000',
        '626296000',
        '626297000',
        '626298000',
        '626299000',
        '626300000',
        '626301000',
        '626302000',
        '626303000',
        '626304000',
        '626305000',
        '626306000',
        '626307000',
        '626308000',
        '626309000',
        '626310000',
        '626311000',
        '626312000',
        '626313000',
        '626314000',
        '626315000',
        '626316000',
        '626319000',
        '626320000',
        '626322000',
        '626323000',
        '626344000',
        '626345000',
        '626346000',
        '626347000',
        '626348000',
        '626349000',
        '626350000',
        '626351000',
        '626352000',
        '626353000',
        '626354000',
        '626355000',
        '626360000',
        '626361000',
        '626362000',
        '626363000',
        '626383000',
        '626384000',
        '626386000',
        '626387000',
        '626388000',
        '626390000',
        '626391000',
        '626392000',
        '626394000',
        '626379000',
        '626380000',
        '626381000',
        '626382000',
        '626368000',
        '626417000',
        '626369000',
        '626415000',
        '626370000',
        '626416000',
        '626371000',
        '626372000',
        '626373000',
        '626374000',
        '626375000',
        '624346000',
        '624347000',
        '626395000',
        '626400000',
        '626401000',
        '626402000',
        '655141000',
        '655129000',
        '623298000',
        '655143000',
        '626403000',
        '626404000',
        '631216000',
        '631222000',
        '631223000',
        '623567000',
        '635115000',
        '623560000',
        '623561000',
        '623562000',
        '623564000',
        '623559000',
        '623565000',
        '623566000',
        '655167000',
        '623910000',
        '623934000',
        '627362000',
        '630351000',
        '630352000',
        '630353000',
        '630355000',
        '630362000',
        '630370000',
        '630371000',
        '630386000',
        '630705000',
        '630706000',
        '630792000',
        '631189000',
        '631945000',
        '631947000',
        '631948000',
        '631949000',
        '655039000',
        '655052000',
        '655168000',
        '655170000',
        '655174000',
        '655178000',
        '655298000',
        '623262000',
        '623276000',
        '623278000',
        '623279000',
        '623281000',
        '623282000',
        '623283000',
        '623284000',
        '630387000',
        'US655038000',
        '630821000',
        '630372000',
        '630378000',
        '630835000',
        '630356000',
        '630357000',
        '630243000',
        '630247000',
        '630239000',
        '630241000',
        '624942000',
        '624941000',
        '624940000',
        '624944000',
        '624945000',
        '625344000',
        '625596000',
        '625592000',
        '625367000',
        '624989000',
        '625368000',
        '624990000',
        '625369000',
        '625549000',
        '624991000',
        '625406000',
        '625349000',
        '627046000',
        '627380000',
        '627301000',
        '627497000',
        'US625342002',
        'US625596020',
        'US625596052',
        'US625596252',
        'US625367002',
        'US625369011',
        'US625369002',
        'US625549002',
        'US625349002',
        '627241000',
        '627242000',
        '627261000',
        '627256000',
        '627240000',
        '627259000',
        '627238000',
        '631618000',
        '631582000',
        '600288000',
        '600298000',
        '623569000',
        '623729000',
        '626420000',
        '626427000',
        '626428000',
        '626429000',
        '626949000',
        '626946000',
        '626947000',
        '626945000',
        '626948000',
        '626943000',
        '626944000',
        '630363000',
        '630388000',
        '657006000',
        '657007000',
        '623768000',
        '623767000',
        '631341890',
        '626738000',
        '626735000',
        '626721000',
        '627235000',
        '627237000',
        '636608000',
        '627234000',
        '630176000',
        '626431000',
        '630174000',
        '656304000',
        '626883000',
        '626884000',
        '626885000',
        '626886000',
        '626887000',
        '626888000',
        '626889000',
        '626891000',
        '626892000',
        '626894000',
        '628876000',
        '628877000',
        '628878000',
        '628879000',
        '628880000',
        '628882000',
        '628883000',
        '628884000',
        '628887000',
        '628888000',
        '628890000',
        '628891000',
        '628892000',
        '628894000',
        '628895000',
        '628896000',
        '628898000',
        '628899000',
        '628901000',
        '628904000',
        '628906000',
        '628907000',
        '628908000',
        '628909000',
        '628911000',
        '628912000',
        '628915000',
        '628917000',
        '628920000',
        '628921000',
        '628922000',
        '628924000',
        '628926000',
        '628960000',
        '628961000',
        '628962000',
        '628963000',
        '628964000',
        '628965000',
        '628966000',
        '628968000',
        '628969000',
        '628970000',
        '628971000',
        '623862000',
        '623867000',
        '630175000',
        '627107000',
        '627354000',
        '628329000',
        '630001000',
        '630002000',
        '630004000',
        '630005000',
        '630201000',
        '630202000',
        '630203000',
        '630474000',
        '630475000',
        '630980420',
        '631042000',
        '631052000',
        '631074000',
        '631078000',
        '631281000',
        '631920000',
        '631921000',
        '631922000',
        '631923000',
        '631936000',
        '635033000',
        '635054000',
        '635056000',
        '635167000',
        '635168000',
        '635252000',
        '635253000',
        '636215000',
        '636216000',
        '636225000',
        '636226000',
        '636321000',
        '636322000',
        '636333000',
        '636341000',
        '636342000',
        '636351000',
        '636356000',
        '636361000',
        '636362000',
        '636364000',
        '636517000',
        '636518000',
        '636519000',
        '636520000',
        '636614000',
        '636617000',
        '636620000',
        '636621000',
        '655173000',
        '600890000',
        '623443000',
        '623603000',
        '623604000',
        '623629000',
        '623631000',
        '623632000',
        '623633000',
        '623634000',
        '623635000',
        '623636000',
        '623637000',
        '623638000',
        '623639000',
        '623640000',
        '623646000',
        '623650000',
        '623654000',
        '623658000',
        '623664000',
        '623665000',
        '623675000',
        '623676000',
        '623677000',
        '623678000',
        '623679000',
        '623687000',
        '623940000',
        '623943000',
        '623971000',
        '623973000',
        '623975000',
        '623980000',
        '624001000',
        '624002000',
        '624003000',
        '624004000',
        '624005000',
        '624006000',
        '624007000',
        '624008000',
        '624019000',
        '624020000',
        '624021000',
        '624022000',
        '624023000',
        '624024000',
        '624025000',
        '624026000',
        '624027000',
        '624037000',
        '624041000',
        '624042000',
        '624043000',
        '624044000',
        '624045000',
        '624046000',
        '624047000',
        '624048000',
        '624051000',
        '624052000',
        '624053000',
        '624054000',
        '624055000',
        '624056000',
        '624057000',
        '624058000',
        '624059000',
        '624060000',
        '624061000',
        '624064000',
        '624066000',
        '624092000',
        '625215000',
        '625216000',
        '625160000',
        '625161000',
        '625162000',
        '625163000',
        '625165000',
        '625166000',
        '625167000',
        '625168000',
        '625169000',
        '625170000',
        '625171000',
        '625172000',
        '625173000',
        '625174000',
        '625175000',
        '625176000',
        '625177000',
        '625178000',
        '625179000',
        '625180000',
        '625182000',
        '625184000',
        '625186000',
        '625188000',
        '625189000',
        '625190000',
        '625191000',
        '625192000',
        '625193000',
        '625195000',
        '625196000',
        '625197000',
        '625198000',
        '625199000',
        '625200000',
        '625201000',
        '625202000',
        '625204000',
        '625205000',
        '625206000',
        '625207000',
        '625208000',
        '625209000',
        '625210000',
        '625211000',
        '625213000',
        '625214000',
        '625434000',
        '625435000',
        '625658000',
        '626566000',
        '628267000',
        '628838000',
        '631130000',
        '631156000',
        '631158000',
        '631169000',
        '631208000',
        '631217000',
        '630261000',
        '631220000',
        '631224000',
        '631226000',
        '631227000',
        '631228000',
        '631229000',
        '631230000',
        '631233000',
        '631235000',
        '631288000',
        '631407000',
        '631470000',
        '631472000',
        '631488000',
        '631491000',
        '631492000',
        '631493000',
        '631494000',
        '631584000',
        '631585000',
        '631586000',
        '631587000',
        '631588000',
        '631589000',
        '631596000',
        '631597000',
        '631907000',
        '631913000',
        '631915000',
        '631925000',
        '631926000',
        '631980000',
        '631981000',
        '631984000',
        '631986000',
        '631987000',
        '631990000',
        '631993000',
        '678001000',
        '678002000',
        '678011000',
        '678012000',
        '678013000',
        '678014000',
        '678101000',
        '678108000',
        '678109000',
        '678115000',
        '678151000',
        '678152000',
        '678201000',
        '678202000',
        '678207000',
        '678225000',
        '678227000',
        '678252000',
        '678253000',
        '678301000',
        '678303000',
        '678401000',
        '678402000',
        '678451000',
        '678652000',
        '630282000',
        '631660000',
        '623595000',
        '626674000',
        '626675000',
        '626676000',
        '626677000',
        '626678000',
        '626679000',
        '626680000',
        '626681000',
        '626682000',
        '626683000',
        '626684000',
        '626685000',
        '626686000',
        '626687000',
        '626688000',
        '626689000',
        '626690000',
        '626691000',
        '628272000',
        '626952000',
        '626954000',
        '626953000',
        '628791000',
        '629010000',
        '629011000',
        '629021000',
        '629026000',
        '629022000',
        '631031000',
        '631019000',
        '631020000',
        '628837000',
        '624306000',
        '628559000',
        '628112000',
        '628572000',
        '628562000',
        '628551000',
        '624304000',
        '628205000',
        '628206000',
        '628208000',
        '628209000',
        '628218000',
        '628270000',
        '628271000',
        '628298000',
        '628299000',
        '628116000',
        '674004000',
        '676290000',
        '674006000',
        '674206000',
        '676291000',
        '674008000',
        '674108000',
        '676138000',
        '676139000',
        '674010000',
        '674210000',
        '674410000',
        '674012000',
        '674412000',
        '674213000',
        '676141000',
        '674014000',
        '674016000',
        '674416000',
        '676142000',
        '676143000',
        '674020000',
        '674420000',
        '676144000',
        '674024000',
        '674028000',
        '676145000',
        '674100000',
        '674300000',
        '676146000',
        '688067000',
        '688068000',
        '688069000',
        '688071000',
        '688072000',
        '674505000',
        '674605000',
        '674506000',
        '674606000',
        '676127000',
        '676147000',
        '674706000',
        '676148000',
        '676507000',
        '674507000',
        '676132000',
        '676129000',
        '676130000',
        '676149000',
        '676131000',
        '674508000',
        '674708000',
        '674808000',
        '674908000',
        '676150000',
        '676151000',
        '674909000',
        '674510000',
        '674710000',
        '674810000',
        '674512000',
        '676125000',
        '674712000',
        '676123000',
        '674713000',
        '674714000',
        '674514000',
        '676153000',
        '676133000',
        '676154000',
        '674516000',
        '674716000',
        '688062000',
        '674816000',
        '674818000',
        '674819000',
        '676155000',
        '676156000',
        '676157000',
        '676158000',
        '674520000',
        '674620000',
        '674720000',
        '676159000',
        '676166000',
        '676167000',
        '674524000',
        '676126000',
        '674624000',
        '674724000',
        '676168000',
        '676169000',
        '674528000',
        '676170000',
        '674728000',
        '676171000',
        '674600000',
        '676172000',
        '674800000',
        '688073000',
        '676276000',
        '674652000',
        '676277000',
        '674656000',
        '676278000',
        '676129100',
        '674558000',
        '676163000',
        '674758000',
        '676281000',
        '676282000',
        '676164000',
        '674562000',
        '676283000',
        '674566000',
        '676286000',
        '676288000',
        'USBIT KIT',
        '674841000',
        '674842000',
        '674844000',
        '674845000',
        '674846000',
        '674847000',
        '674849000',
        '674850000',
        '674851000',
        '674853000',
        '674854000',
        '674855000',
        '674856000',
        '674859000',
        '674860000',
        '674861000',
        '674862000',
        '688074000',
        '676173000',
        '676174000',
        '676177000',
        '676181000',
        '676183000',
        '676185000',
        '676191000',
        '676192000',
        '676193000',
        '676196000',
        '676199000',
        '676201000',
        '676205000',
        '674804000',
        '688065000',
        '688066000',
        '676516000',
        '676616000',
        '676716000',
        '676258000',
        '676134000',
        '676520000',
        '676620000',
        '676720000',
        '676259000',
        '676260000',
        '676524000',
        '676624000',
        '676724000',
        '676261000',
        '676262000',
        '676528000',
        '676628000',
        '676728000',
        '676265000',
        '676700000',
        '676800000',
        '676900000',
        '676266000',
        '676267000',
        '676804000',
        '676904000',
        '676268000',
        '676270000',
        '676908000',
        '676271000',
        '676709000',
        '676912000',
        '676272000',
        '676273000',
        '676274000',
        '676916000',
        '676275000',
        '676924000',
        '676135000',
        '676122000',
        '676223000',
        '676224000',
        '676016000',
        '676116000',
        '676118000',
        '676226000',
        '676227000',
        '676229000',
        '676230000',
        '676246000',
        '676136000',
        '676020000',
        '676120000',
        '676119000',
        '676247000',
        '676248000',
        '676249000',
        '676124000',
        '676324000',
        '676250000',
        '676128000',
        '676328000',
        '676200000',
        '676400000',
        '676253000',
        '676404000',
        '676408000',
        '676255000',
        '676257000',
        '676412000',
        '676301000',
        '676302000',
        '676303000',
        '676304000',
        '676305000',
        '676311000',
        '676312000',
        '676313000',
        '676314000',
        '676315000',
        '676316000',
        '631420420',
        '631425420',
        '631421420',
        '631422420',
        '630992000',
        '655054000',
        '623353420',
        '623354420',
        '655079000',
        '623355420',
        '623384420',
        '623356420',
        '623351420',
        '623352420',
        '623357420',
        '623309000',
        '655053000',
        '623361420',
        '630381420',
        '623364420',
        '655078000',
        '623363420',
        '623360420',
        '630380420',
        '655020000',
        '655022000',
        '655023000',
        '675716000',
        '675720000',
        '675726000',
        '675730000',
        '675736000',
        '675740000',
        '675750000',
        '675701000',
        '675703000',
        '675915000',
        '675910000',
        '675702000',
        '675704000',
        '676293000',
        '676137000',
        '623371000',
        '630928000',
        '631285000',
        '675707000',
        '675706000',
        '675705000',
        '675709000',
        '675711000',
        '675800000',
        '675801000',
        '675803000',
        '675804000',
        '675805000',
        '675848000',
        '675807000',
        '675808000',
        '675809000',
        '675810000',
        '675811000',
        '675812000',
        '675813000',
        '675814000',
        '675815000',
        '675816000',
        '675821000',
        '675823000',
        '675825000',
        '675827000',
        '675829000',
        '675831000',
        '675833000',
        '675835000',
        '675836000',
        '675891000',
        '675892000',
        '626201000',
        '626203000',
        '626208000',
        '626212000',
        '626214000',
        '626237000',
        '626223000',
        '626228000',
        '626232000',
        '626236000',
        '631704000',
        '631706000',
        '631707000',
        '631709000',
        '631710000',
        '630548000',
        '631711000',
        '631712000',
        '631713000',
        '626730000',
        '626731000',
        '626732000',
        '626733000',
        '628216000',
        '655153000',
        '655154000',
        '628214000',
        '628215000',
        'US630342001',
        '630829000',
        '631343000',
        '623770000',
        '623271000',
        '630401000',
        'US626752000',
        '631362000',
        '631363000',
        '631370000',
        '630312000',
        '630316000',
        '630326000',
        '631934000',
        '630325000',
        '630343000',
        '630173000',
        '630317000',
        '630323000',
        '630796000',
        '630867000',
        '630898000',
        '630244000',
        '630245000',
        '630324000',
        '630321000',
        '630329000',
        '630314000',
        '630798000',
        '631940000',
        '630320000',
      ];

      let pagePromise = (link, prodId) =>
        new Promise(async (resolve, reject) => {
          let dataObj = {};
          let additional_description = '';
          let attribute = '';
          let image = '';
          let newPage = await browser.newPage();

          await newPage.goto(link, { waitUntil: 'load', timeout: 30000 });

          let [prodLink] = await newPage.$x('//*[@id="productList_1"]');

          if (typeof (await prodLink) !== 'undefined') {
            link = await prodLink.getProperty('href');
            const prodUrl = await link.jsonValue();
            await newPage.goto(prodUrl, { waitUntil: 'load', timeout: 40000 });

            let [imageLink] = await newPage.$x('//*[@id="zoom1"]');
            if (typeof (await imageLink) !== 'undefined') {
              image = await (await imageLink.getProperty('href')).jsonValue();
            }

            let [descTitle] = await newPage.$x(
              '//*[@id="detailsMain"]/div[1]/div[1]/h1'
            );

            let [descSub] = await newPage.$x(
              '//*[@id="detailsMain"]/div[1]/div[1]/h2'
            );

            descTitle = await descTitle.getProperty('textContent');
            descSub = await descSub.getProperty('textContent');

            let [items] = await newPage.$x('//*[@id="itemTabs"]');
            items = await items.getProperty('children');
            items = await (await items.getProperty('length')).jsonValue();
            for (k = 1; k <= items; k++) {
              let q = `#ui-id-${k}`;
              let x = `//*[@id="itemTabs"]/li[${k}]`;

              let [itemName] = await newPage.$x(x);

              itemName = await itemName.getProperty('textContent');
              itemName = await itemName.jsonValue();

              // additional description
              if (itemName === 'Description') {
                await newPage.click(q);
                let [add_desc] = await newPage.$x('//*[@id="description"]/ul');
                additional_description =
                  '<ul>' +
                  (await (
                    await add_desc.getProperty('innerHTML')
                  ).jsonValue()) +
                  '</ul>';
              }

              // technical stuffs
              if (itemName === 'Technical values') {
                await newPage.click(q);
                let [techValues] = await newPage.$x('//*[@id="attributes"]');

                if (typeof (await techValues) !== 'undefined') {
                  techValues = await techValues.getProperty('children');
                  techValues = await (
                    await techValues.getProperty('length')
                  ).jsonValue();

                  for (i = 1; i <= techValues; i++) {
                    let [techs] = await newPage.$x(
                      `//*[@id="attributes"]/div[${i}]`
                    );
                    techs = await techs.getProperty('children');
                    techs = await (
                      await techs.getProperty('length')
                    ).jsonValue();
                    if (techs > 0) {
                      for (j = 1; j <= techs; j++) {
                        let [attrTitle] = await newPage.$x(
                          `//*[@id="attributes"]/div[${i}]/div[${j}]/div[1]`
                        );
                        let [attrValue] = await newPage.$x(
                          `//*[@id="attributes"]/div[${i}]/div[${j}]/div[2]`
                        );

                        attrTitle = await attrTitle.getProperty('textContent');
                        attrValue = await attrValue.getProperty('textContent');

                        attribute +=
                          (await attrTitle.jsonValue()).trim() +
                          ':' +
                          (await attrValue.jsonValue()).trim() +
                          '|';
                      }
                    }
                  }
                }
              }
            }

            description =
              (await descTitle.jsonValue()).replace(/ *\([^)]*\) */g, '') +
              ' ' +
              (await descSub.jsonValue()).replace(/ *\([^)]*\) */g, '');

            additional_description = additional_description;

            dataObj['product'] = prodId;
            dataObj['description'] = description;
            dataObj['image'] = image;
            dataObj['additional_description'] = additional_description;
            dataObj['attribute'] = attribute;
          }

          resolve(dataObj);
          await newPage.close();
        });

      for (id in catalogs) {
        if (catalogs[id] != null) {
          let currentPageData = await pagePromise(
            `https://www.metabo.com/us/index.php?lang=23&shp=8&cl=search&searchparam=${catalogs[id]}`,
            catalogs[id]
          );
          console.log(id, ' got', catalogs[id]);
          scrapedData.push(currentPageData);
        }
      }

      return scrapedData;
    }

    let data = await scrapeCurrentPage();

    return data;
  },
};

module.exports = metaboScraperObject;
