const santaClaraScraperObject = {
  async scraper(browser) {
    //stores all scrapped data
    let scrapedData = [];

    // opens a new browser
    let newPage = await browser.newPage();

    async function scrapeCurrentPage() {
      let catalogs = [
        '500-5864A',
        '100-3103',
        '100-3104',
        '100-9602',
        '120-1111',
        '120-1113',
        '128-1111',
        '140-1114',
        '2458701-0001',
        '2458740-0001',
        '2458740-1',
        '2459389-0001',
        '2459419-0001',
        '2460221-0001',
        '2460447-8001',
        '2460538-0001',
        '2460541-0001',
        '2460544-0001',
        '2460547-0001',
        '2460556-0001',
        '2460558-0001',
        '2462050-0001',
        '2462149-0001',
        '2462150-0001',
        '2462156-0001',
        '2462188-0001',
        '2462553-0001',
        '2462553-0003',
        '2490005-0001',
        '2490027-0001',
        '2490068-0004',
        '2490712-0001',
        '2491138-0001',
        '2491139-0001',
        '2491149-0001',
        '2491149-0002',
        '2491152-0001',
        '2491152-0002',
        '2491347-0001',
        '2491350-0001',
        '2491425-0001',
        '2491425-0002',
        '2491523-0001',
        '2491525-0001',
        '2491551-0001',
        '2491552-0001',
        '2491573-0001',
        '2491812-8001-W',
        '2491812-8006-W',
        '2492155-0001',
        '2493447-0007',
        '2493458-0001',
        '2493610-0001',
        '2493839-0001',
        '2493842-0001',
        '2586268-0001',
        '2587679-8014',
        '2587695-8002',
        '2587695-8012',
        '2587695-8013',
        '2587695-8014',
        '2587705-8002',
        '2588123-0001',
        '2588733-0001',
        '2588733-0002',
        '2592457-0001',
        '2596536-0001',
        '2600551',
        '2600555',
        '2600582',
        '2600605-0001',
        '2601274-0003',
        '26680',
        '2702748-0001',
        '2702766-0001',
        '2702782-0001',
        '2702885-0001',
        '2702888-0001',
        '2702888-0002',
        '2702891-0001',
        '2702891-0002',
        '2703748-0001',
        '2703834-0001',
        '2704937-0001',
        '2807900-0001',
        '305-01AB',
        '305-01BJ',
        '305-01DA',
        '305-01N',
        '305-01NT',
        '305-01Z',
        '305-02DM',
        '305-02N',
        '305-03DM',
        '305-05N',
        '305-10D',
        '305-10NT',
        '305-20N',
        '305-25N',
        '305-25T',
        '305-35N',
        '305-4ADC-I',
        '305-50T',
        '305-55T',
        '305-6ABM-1',
        '305-DMY',
        '305-PRG',
        '305-PROG',
        '305DC-02B',
        '305S-PROG',
        '315-10R-1',
        '315-AA',
        '315-DD',
        '315DC-DD',
        '325-07',
        '330-37',
        '405-12ABM',
        '405-12ABM-1',
        '405-4DAC-2',
        '405-51ABM',
        '405-8ADC',
        '405-9RLY-I',
        '405-LIC',
        '405-MIU',
        '405-U-05N',
        '405-U-05NH',
        '405-U-05T',
        '405-U-55T',
        '405-U01Z',
        '405-U04B',
        '405-U04BJ',
        '405S-10P',
        '405U-01AD',
        '405U-01T',
        '405U-06B',
        '405U-06BJ',
        '405U-08B',
        '405U-08BJ',
        '405U-08N',
        '405U-15T',
        '405U-18T',
        '405U-20T',
        '405U-25N',
        '405U-38N',
        '405U-55N',
        '500-2101',
        '500-2108',
        '500-2109',
        '500-2112',
        '500-2114',
        '500-2151-A',
        '500-2161',
        '500-5001',
        '500-5002',
        '500-5005',
        '500-5006',
        '500-5007',
        '500-5008',
        '500-5009',
        '500-5011',
        '500-5012',
        '500-5013',
        '500-5016',
        '500-5018',
        '500-5019',
        '500-5020',
        '500-5021',
        '500-5023',
        '500-5024',
        '500-5026',
        '500-5027',
        '500-5028',
        '500-5029',
        '500-5030',
        '500-5031',
        '500-5032',
        '500-5035',
        '500-5037',
        '500-5037A',
        '500-5039',
        '500-5041',
        '500-5047',
        '500-5047A',
        '500-5049',
        '500-5051',
        '500-5052',
        '500-5053',
        '500-5054',
        '500-5055',
        '500-5061',
        '500-5114',
        '500-5114A',
        '500-5190',
        '500-5606',
        '500-5828',
        '500-5840',
        '500-5848',
        '500-5864',
        '500-5864A',
        '500-5884',
        '500-5892',
        '500-6224',
        '500-6870',
        '500-7101',
        '500-7111',
        '500-7302',
        '505-1012',
        '505-188-40-TA',
        '505-2551',
        '505-2552',
        '505-2552A',
        '505-2553',
        '505-2560',
        '505-2560-1',
        '505-2564',
        '505-2573',
        '505-2590',
        '505-2591',
        '505-3532',
        '505-3716',
        '505-386ATM',
        '505-4008A',
        '505-4016A',
        '505-4032',
        '505-4032A',
        '505-4108',
        '505-4116',
        '505-4132',
        '505-4208A',
        '505-4216',
        '505-4216A',
        '505-4232',
        '505-4232A',
        '505-4308',
        '505-4316',
        '505-4316A',
        '505-4317',
        '505-4332',
        '505-4432',
        '505-4508',
        '505-4516',
        '505-4532',
        '505-4608',
        '505-4608A',
        '505-4616',
        '505-4632',
        '505-4632A',
        '505-4716',
        '505-4732',
        '505-4808',
        '505-4816',
        '505-4832',
        '505-4908',
        '505-4916',
        '505-4916A',
        '505-5002',
        '505-5100',
        '505-5184',
        '505-5190',
        '505-5417',
        '505-6010',
        '505-6108',
        '505-6108A',
        '505-6108B',
        '505-6204',
        '505-6208A',
        '505-6208B',
        '505-6308',
        '505-6408',
        '505-6504',
        '505-6508',
        '505-6516',
        '505-6660',
        '505-6663',
        '505-6663A',
        '505-6830',
        '505-6840',
        '505-6851A',
        '505-6851B',
        '505-7002',
        '505-7012',
        '505-7028',
        '505-7028A',
        '505-7038',
        '505-7101',
        '505-7190',
        '505-7201',
        '505-7339',
        '505-7354',
        '505-7510',
        '505-9202',
        '505-ATM',
        '505-ATM-0220',
        '505-ATM-0440',
        '505-CP1434TF',
        '505-CP2572',
        '505-CP5434FMS',
        '505-RACKBRACKET',
        '510-1101',
        '510-1102',
        '510-2101',
        '510-2102',
        '510-3101',
        '510-7105',
        '520-061',
        '520-064',
        '520C-1102',
        '525-1102',
        '525-1104',
        '530-1102',
        '530-1104',
        '545-1101',
        '555-1101',
        '555-1102',
        '555-1103',
        '55CM840400009',
        '560-2120',
        '560-2122',
        '560-2123',
        '560-2126',
        '560-2126B',
        '560-2126R',
        '560-2128A',
        '560-2132',
        '560-2136',
        '560-2820',
        '560-565-2124',
        '565-2120',
        '565-2122',
        '565-2820',
        '575-2102',
        '575-2104',
        '575-2130',
        '575-6600',
        '5MT11-A05L',
        '5MT12-40AL',
        '5MT13-D03L',
        '5MT43',
        '5TI-1013',
        '5TI-1029-1',
        '5TI-1031-1',
        '5TI-1032-1',
        '5TI-1032-2',
        '5TI-1034-1',
        '5TI-2000',
        '5TI-2001',
        '5TI-2459514',
        '5TI-3000',
        '5TI-3101',
        '5TI-3102',
        '5TI-3200',
        '5TI-4100',
        '5TI-5010',
        '5TI-5339',
        '5TI-5500',
        '5TI5-2462006-12',
        '5TI5-2462006-24',
        '5TI5-2462006-48',
        '5TI5-2462007',
        '5TI5-25806',
        '5TI5-25806-12',
        '5TI5-25806-24',
        '5TI5-25806-48',
        '5TI5-25863-24',
        '5TI5-5010',
        '5TI5-5020',
        '6MT11-A05L',
        '6MT11-E05L',
        '6MT12-40AL',
        '6MT12-40EL',
        '6MT13-D05L',
        '6MT13-F05L',
        '6MT14-40DL',
        '6MT31',
        '6MT32',
        '6MT33',
        '6MT50',
        '6MT50-1',
        '6MT50-2',
        '7201',
        '7203',
        '7204',
        '7MT-1504',
        '7MT100',
        '7MT100A',
        '7MT200',
        '7MT210',
        '7MT300',
        '7MT400',
        '7MT600',
        '7MT700',
        '7MT900',
        '7MT902',
        '7PC-911',
        '7PC-912',
        '7PC-912-12',
        '7PC-912-120',
        'A16421-130',
        'A16422-4',
        'A16423-3',
        'CP052LL1',
        'CP200A6',
        'CVU-3604',
        'CVU100-405',
        'G-03M',
        'G-23M',
        'G-53M',
        'PC505-6250',
        'PC505-UPG',
        'PFS-3604',
        'PM550-012',
        'PM550-100',
        'PM550-102',
        'PM550-111',
        'PM550-200',
        'PM550-302',
        'PM550-400',
        'PM550-410',
        'PM550-412',
        'PM550-416',
        'PM550-900',
        'PM550-910',
        'PM550-910-36',
        'PM550-910-6',
        'PM550-912',
        'PM550-912-12',
        'PM550-921-48',
        'PWB2491811-0001',
        'PWB2491811-0003',
        'SN74S387J',
        'SN74S387N',
        'U-20T',
        'VPU200-3104',
      ];

      let pagePromise = (link, prodId) =>
        new Promise(async (resolve, reject) => {
          let dataObj = {};

          // waits for the link to be opened
          await newPage.goto(link, { waitUntil: 'load', timeout: 50000 });

          await newPage.waitForXPath(
            '//*[@id="catalog-hits"]/div/div[3]/div/a'
          );

          let [prodLink] = await newPage.$x(
            '//*[@id="catalog-hits"]/div/div[3]/div/a'
          );

          prodLink = await prodLink.getProperty('href');

          prodLink = await prodLink.jsonValue();

          await newPage.goto(prodLink, { waitUntil: 'load', timeout: 50000 });

          let [chkProd] = await newPage.$x(
            '//*[@id="catalog"]/div/div[3]/div[2]/div[3]/div[2]/h1'
          );
          chkProd = await chkProd.getProperty('textContent');
          chkProd = await chkProd.jsonValue();

          if (prodId !== chkProd) {
            dataObj['product_id'] = prodId;
            dataObj['description'] = '';
            resolve(dataObj);
            return;
          }

          let [description] = await newPage.$x(
            '//*[@id="catalog"]/div/div[3]/div[2]/div[4]/div[1]/div[1]/div/div/div[1]/ul/li/span'
          );

          if (typeof (await description) === 'undefined') {
            dataObj['product_id'] = prodId;
            dataObj['description'] = '';
            resolve(dataObj);
            return;
          }
          description = await description.getProperty('textContent');
          description = await description.jsonValue();

          dataObj['product_id'] = prodId;
          dataObj['description'] = description;

          resolve(dataObj);
          // await newPage.close();
        });

      for (id in catalogs) {
        if (catalogs[id] != null) {
          let currentPageData = await pagePromise(
            `https://www.santaclarasystems.com/en-gb/search?#q=${catalogs[id]}*`,
            catalogs[id]
          );
          console.log(id, ' got', catalogs[id]);
          scrapedData.push(currentPageData);
        }
      }
      await newPage.close();
      return scrapedData;
    }

    let data = await scrapeCurrentPage();

    return data;
  },
};

module.exports = santaClaraScraperObject;
